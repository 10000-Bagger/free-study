# 04. 처리율 제한 장치의 설계

## 1. 처리율 제한 장치의 설계
- 클라이언트 또는 서비스가 보내는 트래픽 처리율을 제어하기 위한 장치
  - 예를 들면 HTTP 요청 횟수
  - 임계치(threshold)를 넘어가면 모든 요청은 중단되는 방식
- 처리율 제한 장치는 왜 필요할까?
  - DoS 공격에 의한 자원 고갈 방지
  - 서버 비용 절감(사용성은 떨어짐), 특히 사용료를 지불하는 API라면 제한을 중요하게 고려해야 함
  - 봇과 같은 잘못된 이용 패턴으로 유발된 트래픽을 걸러낼 수 있다.

## 1단계: 문제 이해 및 설계 범위 확정
- 면접관과 소통을 통해 어떤 제한 장치를 구현해야 하는지 확인할 것
- 알고리즘마다 고유의 장단점이 있는데 요구사항을 파악해야 적절한 알고리즘을 사용할 수 있다.


## 2단계: 개략적 설계안 제시 및 동의 구하기
### 처리율 제한 장치를 어디에 둘 것인가?
- 처리율 제한 장치는 클라이언트, 서버에 둘 수 있을 것이다.
  - 클라이언트: 위변조가 쉬워 안정적인 처리율 제한을 걸기에는 한계가 있다.
  - 서버: API 서버 내부에 둘 수도 있고, 외부에 middleware(또는 API Gateway)로 구성할 수도 있다.
- 서버에 둘 때 고민해볼 것
  - 현재 사용하는 프로그래밍 언어 또는 프레임 워크가 서버측 구현까지 지원하기에 충분히 효율적인가?
  - 처리율 알고리즘은 무엇을 선택할 것인가?
  - 기존 설계에 API Gateway가 포함되어 있는가?

### 처리율 제한
#### (1) Leaky Bucket 알고리즘
- 모든 요청은 FIFO Queue에 담겨 미리 규정된 속도로 처리된다.
- FIFO Queue가 가득차지 않았다면 요청을 받아들인다.
- FIFO Queue가 가득차 있다면 클라에게 에러를 반환한다.