# CSR, SSR

`렌더링 (Rendering)`이란, 실시간으로 브라우저에 웹 사이트가 그려지는 것이다.<br/>
즉, HTML, CSS, JavaScript 등 개발자가 작성한 파일을 서버로부터 받아와 파싱하고 실행한 결과물을 가지고 브라우저에 출력되는 과정을 말한다. <br/>

브라우저에는 `자바스크립트 엔진`과 `렌더링 엔진`이 존재한다.<br/>
먼저, 자바스크립트 엔진은 자바스크립트 코드를 읽어 스크립트를 실행하고, 기능을 동작시키는 역할을 한다.<br/>
그리고 렌더링 엔진은 말그대로 사용자가 볼 화면을 그리는 역할을 한다.

좀 더 자세히 살펴보자면, 서버로부터 응답 받은 `HTML` 문서를 **파싱**하여 `DOM (Document Object Model) Tree`를 구성한다.<br/>
그리고, `CSS` 문서를 **파싱**하여 `CSSOM (CSS Object Model) Tree`를 생성한다.<br/>

자바스크립트 엔진은 서버로부터 응답 받은 JavaScript를 Parsing하여 `Abstract Syntax Tree (AST)`를 생성하고 바이트 코드로 변환하여 실행한다.<br/>
이때 JavaScript는 DOM API를 통해 DOM Tree나 CSSOM Tree를 변경할 수 있다.<br/>
만약 HTML 문서에 `<script>` 태그가 존재한다면 잠시 DOM Tree 생성을 멈추고, script 내용을 해석하고 실행한다.

위에서 만들어진 DOM Tree와 CSSOM Tree를 결합하여 실제 렌더링에 사용할 `Render Tree`를 생성한다.<br/>
그리고, `Layout(혹은 Reflow)`이라고 말하는 단계에서 Render Tree를 활용하여 실제로 그려질 노드의 위치와 크기 등을 계산한다.<br/>
마지막으로 `Paint` 단계에서 Layout 단계에서 계산된 내용으로 실제 화면을 구성하여 보여준다.

그러면 이러한 렌더링 방식에는 어떤 것들이 있을까?

## SSR

> Server Side Rendering

<image src="./1.png" width="600" />

위 그림은 SSR의 동작 방식을 간략히 설명해주고 있다.<br/>
동작 방식은 다음과 같다.

1. 사용자가 웹 사이트에 접근한다.
2. 서버는 브라우저에서 바로 렌더링이 가능한 HTML 파일을 생성한다.
3. 바로 렌더링이 가능한 HTML 파일을 응답받고, 브라우저는 해당 HTML 파일을 파싱하여 즉시 렌더링한다. 하지만, JavaScript 파일이 실행되지 않았기 때문에 사이트를 조작하지는 못하고, 오직 화면의 컨텐츠들만 확인할 수 있다.
4. JavaScript 파일을 다운로드 받는다.
5. 파일을 다운로드 받는 동안, 사용자는 화면을 조작할 수 없지만 사용자가 어떤 조작을 하려했는지 브라우저는 기록해둔다.
6. 브라우저가 다운로드가 완료된 JavaScript 파일을 해석하고 실행한다.
7. 이제 사용자는 웹 페이지와 상호작용하며 화면을 조작할 수 있다.

위 브라우저 렌더링 과정에 대입하여 생각해보자.<br/>
이미 완성되어 렌더링 가능한 HTML 파일을 서버에서 보내주기 때문에 즉시 DOM Tree와 CSSOM Tree를 생성하고 이를 활용하여 Render Tree를 형성해 나갈 것이다.<br/>
이 과정에서 상호작용은 불가능하지만, 컨텐츠들이 포함된 화면을 사용자는 볼 수 있을 것이고, JavaScript 파일이 모두 다운로도되어 실행되고 나면 원하는 상호작용을 하며 화면을 조작할 수 있게 되는 것이다.

그럼 SSR의 장점은 다음과 같이 이야기할 수 있다.

- 서버에서 렌더링이 가능한 완성된 HTML 문서를 응답해주기 때문에 첫 페이지 로딩 속도가 빠르다.
- 같은 이유로 SEO에 대응하기가 용이하다.

그럼 단점은 무엇일까?

- 서버에서 완성된 HTML을 만들어 응답해야하기 때문에 많은 서버 자원을 필요로 한다.
- 첫 페이지 로딩 이후 페이지 이동시 이동할 페이지에 대한 문서들을 요청해야하기 때문에 속도가 느리다.

## CSR

> Client Side Rendering

<image src="./2.png" width="600" />

위 그림은 CSR의 동작 방식을 간략히 설명해주고 있다.<br/>
동작 방식은 다음과 같다.

1. 사용자가 웹 사이트에 접근한다.
2. 서버로부터 HTML 파일과 JavaScript 등 렌더링에 필요한 파일들을 요청한다.
3. 사용자는 모든 파일이 다운로드되어 화면이 렌더링되리 때까지 빈 화면을 보게 된다. HTML 문서의 내용이 비어있기 때문이다.
4. JavaScript 파일이 다운로드가 완료되면, 해석 후 실행한다.
5. 이때 필요한 데이터를 응답받기 위한 API가 호출된다.
6. 응답 받은 데이터를 활용하여 페이지를 완성하고, 이후 사용자는 웹 피이지와 상호작용하며 화면을 조작할 수 있다.

마찬가지로 브라우저 렌더링 과정에 대입해보자.<br/>
서버로부터 HTML 파일에는 최소한의 내용만 담겨있을 것이다.<br/>
따라서 사용자는 당연히 JavaScript 파일이 실행되기 전까지는 빈 화면을 보게 되는 것이다.<br/>
사용자는 해당 웹 사이트에서 필요한 모든 JavaScript 파일을 내려받고 해석하여 실행하며 렌더링되기 때문에 첫 화면을 보기까지 시간이 걸릴 것이다.<br/>
하지만, 필요한 모든 JavaScript 파일을 받아놨기 떄문에 페이지 이동시에도 데이터를 받아오기 위한 API 요청을 제외하고는 더이상 서버에 요청없이 JavaScript에 적혀있는 동작대로 움직여 화면이 매끄럽고 더 빠른 인터랙션이 가능해질 것이다.

그렇다면 CSR의 장점은 다음과 같다.

- API로 데이터를 요청할 때만 서버에 요청을 보내기 때문에 서버의 부담이 적어진다.
- JavaScript 파일대로 브라우저에서 렌더링을 하기 때문에 새로고침이 없고 페이지 전환이 매끄러우며, 더 빠른 인터랙션을 제공한다.

그럼 단점은 무엇일까?

- 첫 요청 시에 모든 JavaScript 파일을 다운받기 때문에 첫 로딩 속도가 느리다.
- 최소한의내용이 포함된 문서로 초기 브라우저 화면을 렌더링하기 때문에 검색 엔진이 데이터를 크롤링을 할 수 없어 SEO에 취약하다.
- 렌더링 로직과 데이터 관련 로직을 모두 프론트엔드 측에서 관리하여 코드가 복잡해질 수 있다.
